!function(){"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),function(){var t;e.g.importScripts&&(t=e.g.location+"");var r=e.g.document;if(!t&&r&&(r.currentScript&&(t=r.currentScript.src),!t)){var o=r.getElementsByTagName("script");o.length&&(t=o[o.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t}();const t={formSelector:".modal__form",saveButtonSelector:".modal__button-save",inputSelector:".modal__input",submitButtonSelector:".modal__submit-btn",inactiveButtonClass:"modal__submit-btn_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error"},r=(e,t,r)=>{const o=t.id+"-error";document.querySelector("#"+o).textContent="",t.classList.remove(r.inputErrorClass)},o=(e,t,r)=>{(e=>e.some(e=>!e.validity.valid))(e)?n(t,r):(t.classList.remove(r.inactiveButtonClass),t.disabled=!1)},n=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0},a=(e,t,o)=>{t.forEach(e=>{r(0,e,o)})};var c=e.p+"ad8dae02f0c7eb97bc8d.svg",l=e.p+"48d18dbfdce98953a057.svg",s=e.p+"d38272e02bb4f1ab1c37.svg",d=e.p+"40608da7369d39bc1077.svg",i=e.p+"29a25a3c4fb6b6e4a7d6.svg",u=e.p+"2e4a436aeb604d724cde.svg";e.p;const m=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}_handleResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}getAppInfo(){return Promise.all([this.getUserInfo(),this.getInitialCards()])}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(this._handleResponse)}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(this._handleResponse)}editUserInfo({name:e,about:t}){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then(this._handleResponse)}editAvatarInfo({avatar:e}){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this._handleResponse)}createCard({name:e,link:t}){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then(this._handleResponse)}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._handleResponse)}changeLikeStatus(e,t){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:t?"DELETE":"PUT",headers:this._headers}).then(this._handleResponse)}likeStatus({cardId:e,isLiked:t}){return this.changeLikeStatus(e,t)}updateUserAvatar({avatar:e}){return this.editAvatarInfo({avatar:e})}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"7b8e7883-cb19-4823-b295-16082b2a282a","Content-Type":"application/json"}});document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".header__logo");e&&(e.src=c);const t=document.querySelector(".profile__edit-icon");t&&(t.src=s);const r=document.querySelector(".profile__pencil-icon");r&&(r.src=l);const o=document.querySelector(".profile__add-icon");o&&(o.src=d)});const _=document.querySelector(".profile__edit-btn"),p=document.querySelector(".profile__add-btn"),h=document.querySelector(".profile__avatar-btn"),f=document.querySelector(".profile__name"),v=document.querySelector(".profile__description"),y=document.querySelector("#edit-modal"),b=y.querySelector(".modal__form"),S=y.querySelector(".modal__close-btn"),g=y.querySelector("#profile-name-input"),q=y.querySelector("#profile-description-input"),E=document.querySelector("#add-card-modal"),k=E.querySelector(".modal__form"),L=(E.querySelector(".modal__close-btn"),k.querySelector("#profile-caption-input")),C=k.querySelector("#add-card-image-link-input"),x=document.querySelector("#avatar-modal"),U=x.querySelector(".modal__form"),w=(x.querySelector(".modal__button"),x.querySelector(".modal__close-btn")),A=x.querySelector("#profile-avatar-input"),I=document.querySelector("#delete-modal"),D=I.querySelector("#delete-form"),$=I.querySelector(".delete-modal__close-btn"),B=I.querySelector('button[type="button"]:not(.delete-modal__close-btn)');B&&B.addEventListener("click",()=>X(I));const T=document.querySelector(".profile__add-btn"),R=document.querySelector("#add-card-modal"),G=R.querySelector(".modal__close-btn"),P=(R.querySelector(".modal__form"),R.querySelector("#add-card-image-link-input")),j=R.querySelector("#profile-caption-input"),N=document.querySelector("#preview-modal"),O=N.querySelector(".modal__image"),M=N.querySelector(".modal__caption"),F=N.querySelector(".modal__close-btn_type_preview"),J=document.querySelector(".cards__list");let z,H,K=null;const Q=document.querySelector("#card-template").content.querySelector(".card");if(!document.querySelector("#card-template"))throw new Error("Missing #card-template in index.html");function V(e){const t=Q.cloneNode(!0),r=t.querySelector(".card__image"),o=t.querySelector(".card__title"),n=t.querySelector(".card__delete-btn");r.src=e.link,r.alt=e.name,o.textContent=e.name,n.addEventListener("click",()=>{z=t,H=e._id,W(I)}),r.addEventListener("click",()=>{W(N),O.src=e.link,O.alt=e.name,M.textContent=e.name});const a=t.querySelector(".card__like-btn");return a&&(e.isLiked?(a.classList.add("card__like-button_active"),a.style.backgroundImage=`url(${u})`):(a.classList.remove("card__like-button_active"),a.style.backgroundImage=`url(${i})`),a.style.backgroundSize="contain",a.style.backgroundRepeat="no-repeat"),a.addEventListener("click",t=>function(e,t){const r=e.target.closest(".card__like-btn");if(!r)return;const o=r.classList.contains("card__like-button_active");m.likeStatus({cardId:t,isLiked:o}).then(e=>{e.isLiked?(r.classList.add("card__like-button_active"),r.style.backgroundImage=`url(${u})`):(r.classList.remove("card__like-button_active"),r.style.backgroundImage=`url(${i})`)}).catch(console.error)}(t,e._id)),t}function W(e){try{console.debug("openModal called for:",e&&e.id?e.id:e),console.trace()}catch(e){}e.classList.add("modal_opened"),document.addEventListener("keydown",Y)}function X(e){e.classList.remove("modal_opened"),document.removeEventListener("keydown",Y)}function Y(e){const t=document.querySelector(".modal_opened");if("keydown"===e.type&&"Escape"===e.key&&t&&X(t),"mousedown"===e.type){if(e.target.classList.contains("modal"))return void X(e.target);if(e.target.classList.contains("delete-modal__close-btn")){const t=e.target.closest(".modal");t&&X(t)}}}var Z;F.addEventListener("click",()=>{X(N)}),document.querySelectorAll(".modal").forEach(e=>{e.addEventListener("mousedown",Y)}),k.addEventListener("submit",function(e){e.preventDefault();const r=e.submitter,o=r.textContent;r.textContent="Saving...",r.disabled=!0;const a={name:L.value,link:C.value};m.createCard(a).then(o=>{const a=V(o);J.prepend(a),X(E),e.target.reset(),n(r,t)}).catch(e=>{console.error(e),r.disabled=!1}).finally(()=>{r.textContent=o})}),b.addEventListener("submit",function(e){e.preventDefault();const r=e.submitter,o=r.textContent;r.textContent="Saving...",r.disabled=!0,m.editUserInfo({name:g.value,about:q.value}).then(e=>{e&&(f&&(f.textContent=e.name||""),v&&(v.textContent=e.about||"")),X(y),n(r,t)}).catch(console.error).finally(()=>{r.textContent=o,r.disabled=!1})}),h.addEventListener("click",function(){W(x),a(0,[A],t)}),w.addEventListener("click",function(){X(x)}),U.addEventListener("submit",function(e){e.preventDefault();const t=e.submitter,r=t.textContent;t.textContent="Saving...",t.disabled=!0,m.updateUserAvatar({avatar:A.value}).then(e=>{if(e&&e.avatar){const t=document.querySelector(".profile__avatar");t&&(t.alt="User avatar",t.src=e.avatar)}X(x)}).catch(e=>{console.error(e),t.disabled=!1}).finally(()=>{t.textContent=r})}),_.addEventListener("click",()=>{g.value=f.textContent,q.value=v.textContent,a(0,[g,q],t),W(y)}),S.addEventListener("click",function(){X(y)}),T.addEventListener("click",function(){W(R),a(0,[P,j],t)}),G.addEventListener("click",function(){X(R)}),p.addEventListener("click",()=>{W(E)}),D.addEventListener("submit",e=>{e.preventDefault();const t=e.submitter,r=t.textContent;t.textContent="Deleting...",t.disabled=!0,H&&m.deleteCard(H).then(()=>{z&&z.remove(),z=null,H=null,X(I)}).catch(console.error).finally(()=>{t.textContent=r,t.disabled=!1})}),$.addEventListener("click",()=>X(I)),Z=t,document.querySelectorAll(Z.formSelector).forEach(e=>{((e,t)=>{const n=Array.from(e.querySelectorAll(t.inputSelector)),a=e.querySelector(t.submitButtonSelector);a&&(o(n,a,t),n.forEach(e=>{e.addEventListener("input",()=>{((e,t,o)=>{t.validity.valid?r(0,t,o):((e,t,r,o)=>{const n=t.id+"-error";document.querySelector("#"+n).textContent=r,t.classList.add(o.inputErrorClass)})(0,t,t.validationMessage,o)})(0,e,t),o(n,a,t)})}))})(e,Z)}),document.addEventListener("DOMContentLoaded",()=>{const e=Array.from(document.querySelectorAll(".modal_opened"));if(e.length)try{console.warn("Found modal(s) opened on load, closing them:",e.map(e=>e.id||e))}catch(e){}e.forEach(e=>e.classList.remove("modal_opened"));try{J&&Q&&m.getAppInfo().then(([e,t])=>{try{console.debug("getAppInfo user:",e),console.debug("getAppInfo cards:",t)}catch(e){}if(e){K=e._id;const t=document.querySelector(".profile__avatar"),r=document.querySelector(".profile__name"),o=document.querySelector(".profile__description");console.log("[DEBUG] avatarEl:",t),console.log("[DEBUG] nameEl:",r),console.log("[DEBUG] descEl:",o),t&&(t.src=e.avatar||"",console.log("[DEBUG] Set avatar src to:",t.src)),r&&(r.textContent=e.name||"",console.log("[DEBUG] Set name textContent to:",r.textContent)),o&&(o.textContent=e.about||"",console.log("[DEBUG] Set description textContent to:",o.textContent))}else console.warn("[DEBUG] No user object returned from server");(Array.isArray(t)?t:[]).forEach(e=>{const t=V(e);J.prepend(t)})}).catch(e=>{console.error("Error loading initial app info:",e)})}catch(e){console.error("Failed to call loadInitialData:",e)}})}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RUFBUzVMLE1BRWpENkwsSUFDRkEsRUFBT3ZLLFlBQWNvSyxFQUFLaEksTUFBUSxHQUNsQ3dGLFFBQVE2QyxJQUFJLG1DQUFvQ0YsRUFBT3ZLLGNBRXJEd0ssSUFDRkEsRUFBT3hLLFlBQWNvSyxFQUFLL0gsT0FBUyxHQUNuQ3VGLFFBQVE2QyxJQUNOLDBDQUNBRCxFQUFPeEssYUFHYixNQUNFNEgsUUFBUXFDLEtBQUssZ0RBR09ULE1BQU1rQixRQUFRTCxHQUFTQSxFQUFRLElBQ3ZDdEosUUFBUzRKLElBQ3JCLE1BQU1yRSxFQUFjRixFQUFldUUsR0FDbkM3RSxFQUFVbUQsUUFBUTNDLE9BR3JCcUIsTUFBT08sSUFDTk4sUUFBUUMsTUFBTSxrQ0FBbUNLLElBMFdyRCxDQUFFLE1BQU9BLEdBQ1BOLFFBQVFDLE1BQU0sa0NBQW1DSyxFQUNuRCxHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy0yL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMtMi93ZWJwYWNrL3J1bnRpbWUvZ2xvYmFsIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMtMi93ZWJwYWNrL3J1bnRpbWUvcHVibGljUGF0aCIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLTIvLi9zcmMvc2NyaXB0cy92YWxpZGF0ZS5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLTIvLi9zcmMvdXRpbHMvQXBpLmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMtMi8uL3NyYy9wYWdlcy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBUaGUgcmVxdWlyZSBzY29wZVxudmFyIF9fd2VicGFja19yZXF1aXJlX18gPSB7fTtcblxuIiwiX193ZWJwYWNrX3JlcXVpcmVfXy5nID0gKGZ1bmN0aW9uKCkge1xuXHRpZiAodHlwZW9mIGdsb2JhbFRoaXMgPT09ICdvYmplY3QnKSByZXR1cm4gZ2xvYmFsVGhpcztcblx0dHJ5IHtcblx0XHRyZXR1cm4gdGhpcyB8fCBuZXcgRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKTtcblx0fSBjYXRjaCAoZSkge1xuXHRcdGlmICh0eXBlb2Ygd2luZG93ID09PSAnb2JqZWN0JykgcmV0dXJuIHdpbmRvdztcblx0fVxufSkoKTsiLCJ2YXIgc2NyaXB0VXJsO1xuaWYgKF9fd2VicGFja19yZXF1aXJlX18uZy5pbXBvcnRTY3JpcHRzKSBzY3JpcHRVcmwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fLmcubG9jYXRpb24gKyBcIlwiO1xudmFyIGRvY3VtZW50ID0gX193ZWJwYWNrX3JlcXVpcmVfXy5nLmRvY3VtZW50O1xuaWYgKCFzY3JpcHRVcmwgJiYgZG9jdW1lbnQpIHtcblx0aWYgKGRvY3VtZW50LmN1cnJlbnRTY3JpcHQpXG5cdFx0c2NyaXB0VXJsID0gZG9jdW1lbnQuY3VycmVudFNjcmlwdC5zcmNcblx0aWYgKCFzY3JpcHRVcmwpIHtcblx0XHR2YXIgc2NyaXB0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwic2NyaXB0XCIpO1xuXHRcdGlmKHNjcmlwdHMubGVuZ3RoKSBzY3JpcHRVcmwgPSBzY3JpcHRzW3NjcmlwdHMubGVuZ3RoIC0gMV0uc3JjXG5cdH1cbn1cbi8vIFdoZW4gc3VwcG9ydGluZyBicm93c2VycyB3aGVyZSBhbiBhdXRvbWF0aWMgcHVibGljUGF0aCBpcyBub3Qgc3VwcG9ydGVkIHlvdSBtdXN0IHNwZWNpZnkgYW4gb3V0cHV0LnB1YmxpY1BhdGggbWFudWFsbHkgdmlhIGNvbmZpZ3VyYXRpb25cbi8vIG9yIHBhc3MgYW4gZW1wdHkgc3RyaW5nIChcIlwiKSBhbmQgc2V0IHRoZSBfX3dlYnBhY2tfcHVibGljX3BhdGhfXyB2YXJpYWJsZSBmcm9tIHlvdXIgY29kZSB0byB1c2UgeW91ciBvd24gbG9naWMuXG5pZiAoIXNjcmlwdFVybCkgdGhyb3cgbmV3IEVycm9yKFwiQXV0b21hdGljIHB1YmxpY1BhdGggaXMgbm90IHN1cHBvcnRlZCBpbiB0aGlzIGJyb3dzZXJcIik7XG5zY3JpcHRVcmwgPSBzY3JpcHRVcmwucmVwbGFjZSgvIy4qJC8sIFwiXCIpLnJlcGxhY2UoL1xcPy4qJC8sIFwiXCIpLnJlcGxhY2UoL1xcL1teXFwvXSskLywgXCIvXCIpO1xuX193ZWJwYWNrX3JlcXVpcmVfXy5wID0gc2NyaXB0VXJsOyIsImV4cG9ydCBjb25zdCB2YWxpZGF0aW9uQ29uZmlnID0ge1xuICBmb3JtU2VsZWN0b3I6IFwiLm1vZGFsX19mb3JtXCIsXG4gIHNhdmVCdXR0b25TZWxlY3RvcjogXCIubW9kYWxfX2J1dHRvbi1zYXZlXCIsXG4gIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIubW9kYWxfX3N1Ym1pdC1idG5cIixcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJtb2RhbF9fc3VibWl0LWJ0bl9kaXNhYmxlZFwiLFxuICBpbnB1dEVycm9yQ2xhc3M6IFwibW9kYWxfX2lucHV0X3R5cGVfZXJyb3JcIixcbiAgZXJyb3JDbGFzczogXCJtb2RhbF9fZXJyb3JcIixcbn07XG5cbmNvbnN0IHNob3dJbnB1dEVycm9yID0gKGZvcm1FbCwgaW5wdXRFbCwgZXJyb3JNc2csIGNvbmZpZykgPT4ge1xuICBjb25zdCBlcnJvck1zZ0lEID0gaW5wdXRFbC5pZCArIFwiLWVycm9yXCI7XG4gIGNvbnN0IGVycm9yTXNnRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI1wiICsgZXJyb3JNc2dJRCk7XG4gIGVycm9yTXNnRWwudGV4dENvbnRlbnQgPSBlcnJvck1zZztcbiAgaW5wdXRFbC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xufTtcblxuY29uc3QgaGlkZUlucHV0RXJyb3IgPSAoZm9ybUVsLCBpbnB1dEVsLCBjb25maWcpID0+IHtcbiAgY29uc3QgZXJyb3JNc2dJRCA9IGlucHV0RWwuaWQgKyBcIi1lcnJvclwiO1xuICBjb25zdCBlcnJvck1zZ0VsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNcIiArIGVycm9yTXNnSUQpO1xuICBlcnJvck1zZ0VsLnRleHRDb250ZW50ID0gXCJcIjtcbiAgaW5wdXRFbC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xufTtcblxuY29uc3QgY2hlY2tJbnB1dFZhbGlkaXR5ID0gKGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKSA9PiB7XG4gIGlmICghaW5wdXRFbC52YWxpZGl0eS52YWxpZCkge1xuICAgIHNob3dJbnB1dEVycm9yKGZvcm1FbCwgaW5wdXRFbCwgaW5wdXRFbC52YWxpZGF0aW9uTWVzc2FnZSwgY29uZmlnKTtcbiAgfSBlbHNlIHtcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWwsIGlucHV0RWwsIGNvbmZpZyk7XG4gIH1cbn07XG5cbmNvbnN0IGhhc0ludmFsaWRJbnB1dCA9IChpbnB1dExpc3QpID0+IHtcbiAgcmV0dXJuIGlucHV0TGlzdC5zb21lKChpbnB1dCkgPT4ge1xuICAgIHJldHVybiAhaW5wdXQudmFsaWRpdHkudmFsaWQ7XG4gIH0pO1xufTtcblxuY29uc3QgdG9nZ2xlQnV0dG9uU3RhdGUgPSAoaW5wdXRMaXN0LCBidXR0b25FbCwgY29uZmlnKSA9PiB7XG4gIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0LCBidXR0b25FbCkpIHtcbiAgICBkaXNhYmxlQnV0dG9uKGJ1dHRvbkVsLCBjb25maWcpO1xuICB9IGVsc2Uge1xuICAgIGJ1dHRvbkVsLmNsYXNzTGlzdC5yZW1vdmUoY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICAgIGJ1dHRvbkVsLmRpc2FibGVkID0gZmFsc2U7XG4gIH1cbn07XG5cbmNvbnN0IGRpc2FibGVCdXR0b24gPSAoYnV0dG9uRWwsIGNvbmZpZykgPT4ge1xuICBidXR0b25FbC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgYnV0dG9uRWwuZGlzYWJsZWQgPSB0cnVlO1xufTtcblxuY29uc3QgcmVzZXRWYWxpZGF0aW9uID0gKGZvcm1FbCwgaW5wdXRMaXN0LCBjb25maWcpID0+IHtcbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsLCBpbnB1dCwgY29uZmlnKTtcbiAgfSk7XG59O1xuXG5jb25zdCBzZXRFdmVudExpc3RlbmVycyA9IChmb3JtRWxlbWVudCwgY29uZmlnKSA9PiB7XG4gIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oXG4gICAgZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChjb25maWcuaW5wdXRTZWxlY3RvcilcbiAgKTtcbiAgY29uc3QgYnV0dG9uRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoY29uZmlnLnN1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcblxuICBpZiAoIWJ1dHRvbkVsZW1lbnQpIHJldHVybjsgLy8g4pqhIFByb3RlY3Rpb246IHNhZmVseSBleGl0IGlmIG5vIGJ1dHRvblxuXG4gIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcblxuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgICBjaGVja0lucHV0VmFsaWRpdHkoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgY29uZmlnKTtcbiAgICAgIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcbiAgICB9KTtcbiAgfSk7XG59O1xuXG5leHBvcnQgY29uc3QgZW5hYmxlVmFsaWRhdGlvbiA9IChjb25maWcpID0+IHtcbiAgY29uc3QgZm9ybUxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5mb3JtU2VsZWN0b3IpO1xuICBmb3JtTGlzdC5mb3JFYWNoKChmb3JtRWwpID0+IHtcbiAgICBzZXRFdmVudExpc3RlbmVycyhmb3JtRWwsIGNvbmZpZyk7XG4gIH0pO1xufTtcblxuZXhwb3J0IHsgZGlzYWJsZUJ1dHRvbiwgcmVzZXRWYWxpZGF0aW9uIH07XG4iLCJjbGFzcyBBcGkge1xuICBjb25zdHJ1Y3Rvcih7IGJhc2VVcmwsIGhlYWRlcnMgfSkge1xuICAgIHRoaXMuX2Jhc2VVcmwgPSBiYXNlVXJsO1xuICAgIHRoaXMuX2hlYWRlcnMgPSBoZWFkZXJzO1xuICB9XG5cbiAgLy8gVE9ETyBDcmVhdGUgYW5vdGVyIG1ldGhvZCwgZ2V0VXNlckluZm8gKGRpZmZlcmVudCBiYXNlIHVybClcbiAgX2hhbmRsZVJlc3BvbnNlKHJlcykge1xuICAgIGlmIChyZXMub2spIHtcbiAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgIH1cbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gIH1cblxuICBnZXRBcHBJbmZvKCkge1xuICAgIC8vIFJldHVybiBib3RoIHVzZXIgaW5mbyBhbmQgaW5pdGlhbCBjYXJkcyBzbyBjYWxsZXJzIGNhbiBkZXN0cnVjdHVyZSBbdXNlciwgY2FyZHNdXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFt0aGlzLmdldFVzZXJJbmZvKCksIHRoaXMuZ2V0SW5pdGlhbENhcmRzKCldKTtcbiAgfVxuXG4gIGdldEluaXRpYWxDYXJkcygpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4odGhpcy5faGFuZGxlUmVzcG9uc2UpO1xuICB9XG5cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuX2hhbmRsZVJlc3BvbnNlKTtcbiAgfVxuXG4gIC8vIFRPRE8gLSBpbXBsZW1lbnQgUE9TVCAvY2FyZHNcblxuICBlZGl0VXNlckluZm8oeyBuYW1lLCBhYm91dCB9KSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBuYW1lLFxuICAgICAgICBhYm91dCxcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4odGhpcy5faGFuZGxlUmVzcG9uc2UpO1xuICB9XG5cbiAgLy8gVE9ETyAtIGltcGxlbWVudCBQT1NUIC9jYXJkc1xuXG4gIGVkaXRBdmF0YXJJbmZvKHsgYXZhdGFyIH0pIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBhdmF0YXIsXG4gICAgICB9KSxcbiAgICB9KS50aGVuKHRoaXMuX2hhbmRsZVJlc3BvbnNlKTtcbiAgfVxuXG4gIGNyZWF0ZUNhcmQoeyBuYW1lLCBsaW5rIH0pIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgbGluayxcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4odGhpcy5faGFuZGxlUmVzcG9uc2UpO1xuICB9XG5cbiAgZGVsZXRlQ2FyZChpZCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2lkfWAsIHtcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbih0aGlzLl9oYW5kbGVSZXNwb25zZSk7XG4gIH1cblxuICBjaGFuZ2VMaWtlU3RhdHVzKGlkLCBpc0xpa2VkKSB7XG4gICAgLy8gQWx3YXlzIHVzZSB0aGUgY29ycmVjdCBlbmRwb2ludCBmb3IgbGlrZS9kaXNsaWtlXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7aWR9L2xpa2VzYCwge1xuICAgICAgbWV0aG9kOiBpc0xpa2VkID8gXCJERUxFVEVcIiA6IFwiUFVUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4odGhpcy5faGFuZGxlUmVzcG9uc2UpO1xuICB9XG5cbiAgLy8gV3JhcHBlciB0byBtYXRjaCBhcHAgdXNhZ2U6IGxpa2VTdGF0dXMoeyBjYXJkSWQsIGlzTGlrZWQgfSlcbiAgbGlrZVN0YXR1cyh7IGNhcmRJZCwgaXNMaWtlZCB9KSB7XG4gICAgcmV0dXJuIHRoaXMuY2hhbmdlTGlrZVN0YXR1cyhjYXJkSWQsIGlzTGlrZWQpO1xuICB9XG5cbiAgLy8gV3JhcHBlciB0byBtYXRjaCBhcHAgdXNhZ2U6IHVwZGF0ZVVzZXJBdmF0YXIoeyBhdmF0YXIgfSlcbiAgdXBkYXRlVXNlckF2YXRhcih7IGF2YXRhciB9KSB7XG4gICAgcmV0dXJuIHRoaXMuZWRpdEF2YXRhckluZm8oeyBhdmF0YXIgfSk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQXBpO1xuIiwiaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcbmltcG9ydCB7XG4gIGVuYWJsZVZhbGlkYXRpb24sXG4gIHZhbGlkYXRpb25Db25maWcsXG4gIHJlc2V0VmFsaWRhdGlvbixcbiAgZGlzYWJsZUJ1dHRvbixcbn0gZnJvbSBcIi4uL3NjcmlwdHMvdmFsaWRhdGUuanNcIjtcbmltcG9ydCBBcGkgZnJvbSBcIi4uL3V0aWxzL0FwaS5qc1wiO1xuaW1wb3J0IHsgc2V0QnV0dG9uVGV4dCB9IGZyb20gXCIuLi91dGlscy9oZWxwZXJzXCI7XG5pbXBvcnQgbG9nb1VybCBmcm9tIFwiLi4vaW1hZ2VzL0xvZ28uc3ZnXCI7XG5cbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLWFwaS5lbi50cmlwbGV0ZW4tc2VydmljZXMuY29tL3YxXCIsXG4gIGhlYWRlcnM6IHtcbiAgICBhdXRob3JpemF0aW9uOiBcIjdiOGU3ODgzLWNiMTktNDgyMy1iMjk1LTE2MDgyYjJhMjgyYVwiLFxuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICB9LFxufSk7XG5pbXBvcnQgcGVuY2lsTGlnaHRVcmwgZnJvbSBcIi4uL2ltYWdlcy9wZW5jaWwtbGlnaHQuc3ZnXCI7XG5pbXBvcnQgcGVuY2lsVXJsIGZyb20gXCIuLi9pbWFnZXMvcGVuY2lsLnN2Z1wiO1xuaW1wb3J0IHBsdXNVcmwgZnJvbSBcIi4uL2ltYWdlcy9wbHVzLnN2Z1wiO1xuaW1wb3J0IGhlYXJ0VXJsIGZyb20gXCIuLi9pbWFnZXMvaGVhcnQuc3ZnXCI7XG5pbXBvcnQgbGlrZWRVcmwgZnJvbSBcIi4uL2ltYWdlcy9MaWtlLWljb24tbGlrZWQuc3ZnXCI7XG5pbXBvcnQgbGlrZWRIb3ZlclVybCBmcm9tIFwiLi4vaW1hZ2VzL0xpa2UtaWNvbi1saWtlZC1ob3Zlci5zdmdcIjtcblxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgKCkgPT4ge1xuICBjb25zdCBsb2dvSW1nID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5oZWFkZXJfX2xvZ29cIik7XG4gIGlmIChsb2dvSW1nKSBsb2dvSW1nLnNyYyA9IGxvZ29Vcmw7XG5cbiAgY29uc3QgcHJvZmlsZUVkaXRJY29uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWljb25cIik7XG4gIGlmIChwcm9maWxlRWRpdEljb24pIHByb2ZpbGVFZGl0SWNvbi5zcmMgPSBwZW5jaWxVcmw7XG5cbiAgY29uc3QgcHJvZmlsZVBlbmNpbEljb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX3BlbmNpbC1pY29uXCIpO1xuICBpZiAocHJvZmlsZVBlbmNpbEljb24pIHByb2ZpbGVQZW5jaWxJY29uLnNyYyA9IHBlbmNpbExpZ2h0VXJsO1xuXG4gIGNvbnN0IGFkZEljb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2FkZC1pY29uXCIpO1xuICBpZiAoYWRkSWNvbikgYWRkSWNvbi5zcmMgPSBwbHVzVXJsO1xufSk7XG5cbmNvbnN0IHByZWxvYWRlZENhcmRzID0gW1xuICB7XG4gICAgbmFtZTogXCJWYWwgVGhvcmVuc1wiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9zcG90cy8xLXBob3RvLWJ5LW1vcml0ei1mZWxkbWFubi1mcm9tLXBleGVscy5qcGdcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiUmVzdGF1cmFudCB0ZXJyYWNlXCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzItcGhvdG8tYnktY2VpbGluZS1mcm9tLXBleGVscy5qcGdcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiQW4gb3V0ZG9vciBjYWZlXCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzMtcGhvdG8tYnktdHViYW51ci1kb2dhbi1mcm9tLXBleGVscy5qcGdcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiQSB2ZXJ5IGxvbmcgYnJpZGdlLi4uXCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzQtcGhvdG8tYnktbWF1cmljZS1sYXNjaGV0LWZyb20tcGV4ZWxzLmpwZ1wiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJUdW5uZWwgd2l0aCBtb3JuaW5nIGxpZ2h0XCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzUtcGhvdG8tYnktdmFuLWFuaC1uZ3V5ZW4tZnJvbS1wZXhlbHMuanBnXCIsXG4gIH0sXG4gIHtcbiAgICBuYW1lOiBcIk1vdW50YWluIGhvdXNlXCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzYtcGhvdG8tYnktbW9yaXR6LWZlbGRtYW5uLWZyb20tcGV4ZWxzLmpwZ1wiLFxuICB9LFxuXTtcblxuZnVuY3Rpb24gbG9hZEluaXRpYWxEYXRhKCkge1xuICBpZiAoIWNhcmRzTGlzdCB8fCAhY2FyZFRlbXBsYXRlKSByZXR1cm47XG5cbiAgYXBpXG4gICAgLmdldEFwcEluZm8oKVxuICAgIC50aGVuKChbdXNlciwgY2FyZHNdKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zb2xlLmRlYnVnKFwiZ2V0QXBwSW5mbyB1c2VyOlwiLCB1c2VyKTtcbiAgICAgICAgY29uc29sZS5kZWJ1ZyhcImdldEFwcEluZm8gY2FyZHM6XCIsIGNhcmRzKTtcbiAgICAgIH0gY2F0Y2ggKGVycikge31cblxuICAgICAgaWYgKHVzZXIpIHtcbiAgICAgICAgY3VycmVudFVzZXJJZCA9IHVzZXIuX2lkO1xuICAgICAgICBjb25zdCBhdmF0YXJFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyXCIpO1xuICAgICAgICBjb25zdCBuYW1lRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX25hbWVcIik7XG4gICAgICAgIGNvbnN0IGRlc2NFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZGVzY3JpcHRpb25cIik7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiW0RFQlVHXSBhdmF0YXJFbDpcIiwgYXZhdGFyRWwpO1xuICAgICAgICBjb25zb2xlLmxvZyhcIltERUJVR10gbmFtZUVsOlwiLCBuYW1lRWwpO1xuICAgICAgICBjb25zb2xlLmxvZyhcIltERUJVR10gZGVzY0VsOlwiLCBkZXNjRWwpO1xuICAgICAgICBpZiAoYXZhdGFyRWwpIHtcbiAgICAgICAgICBhdmF0YXJFbC5zcmMgPSB1c2VyLmF2YXRhciB8fCBcIlwiO1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiW0RFQlVHXSBTZXQgYXZhdGFyIHNyYyB0bzpcIiwgYXZhdGFyRWwuc3JjKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobmFtZUVsKSB7XG4gICAgICAgICAgbmFtZUVsLnRleHRDb250ZW50ID0gdXNlci5uYW1lIHx8IFwiXCI7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJbREVCVUddIFNldCBuYW1lIHRleHRDb250ZW50IHRvOlwiLCBuYW1lRWwudGV4dENvbnRlbnQpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChkZXNjRWwpIHtcbiAgICAgICAgICBkZXNjRWwudGV4dENvbnRlbnQgPSB1c2VyLmFib3V0IHx8IFwiXCI7XG4gICAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgICBcIltERUJVR10gU2V0IGRlc2NyaXB0aW9uIHRleHRDb250ZW50IHRvOlwiLFxuICAgICAgICAgICAgZGVzY0VsLnRleHRDb250ZW50XG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS53YXJuKFwiW0RFQlVHXSBObyB1c2VyIG9iamVjdCByZXR1cm5lZCBmcm9tIHNlcnZlclwiKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgZXhpc3RpbmdDYXJkcyA9IEFycmF5LmlzQXJyYXkoY2FyZHMpID8gY2FyZHMgOiBbXTtcbiAgICAgIGV4aXN0aW5nQ2FyZHMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICBjb25zdCBjYXJkRWxlbWVudCA9IGdldENhcmRFbGVtZW50KGl0ZW0pO1xuICAgICAgICBjYXJkc0xpc3QucHJlcGVuZChjYXJkRWxlbWVudCk7XG4gICAgICB9KTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgbG9hZGluZyBpbml0aWFsIGFwcCBpbmZvOlwiLCBlcnIpO1xuICAgIH0pO1xufVxuXG4vLyBQcm9maWxlIGVsZW1lbnRzXG5jb25zdCBwcm9maWxlRWRpdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZWRpdC1idG5cIik7XG5jb25zdCBjYXJkTW9kYWxCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2FkZC1idG5cIik7XG5jb25zdCBhdmF0YXJNb2RhbEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyLWJ0blwiKTtcbmNvbnN0IHByb2ZpbGVOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uYW1lXCIpO1xuY29uc3QgcHJvZmlsZURlc2NyaXB0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19kZXNjcmlwdGlvblwiKTtcblxuLy8gRm9ybSBlbGVtZW50c1xuY29uc3QgZWRpdE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNlZGl0LW1vZGFsXCIpO1xuY29uc3QgZWRpdEZvcm1FbGVtZW50ID0gZWRpdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG5jb25zdCBlZGl0UHJvZmlsZUNsb3NlQnRuID0gZWRpdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ0blwiKTtcbmNvbnN0IGVkaXRNb2RhbE5hbWVJbnB1dCA9IGVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtbmFtZS1pbnB1dFwiKTtcbmNvbnN0IGVkaXRNb2RhbERlc2NyaXB0aW9uSW5wdXQgPSBlZGl0TW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIjcHJvZmlsZS1kZXNjcmlwdGlvbi1pbnB1dFwiXG4pO1xuY29uc3QgY2FyZE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC1tb2RhbFwiKTtcbmNvbnN0IGNhcmRGb3JtID0gY2FyZE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG5jb25zdCBjYXJkTW9kYWxDbG9zZUJ0biA9IGNhcmRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idG5cIik7XG5jb25zdCBjYXJkTmFtZUlucHV0ID0gY2FyZEZvcm0ucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlLWNhcHRpb24taW5wdXRcIik7XG5jb25zdCBjYXJkTGlua0lucHV0ID0gY2FyZEZvcm0ucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC1pbWFnZS1saW5rLWlucHV0XCIpO1xuXG4vLyBBdmF0YXIgZm9ybSBlbGVtZW50XG5jb25zdCBhdmF0YXJNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYXZhdGFyLW1vZGFsXCIpO1xuY29uc3QgYXZhdGFyTW9kYWxGb3JtID0gYXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcbmNvbnN0IGF2YXRhclN1Ym1pdEJ0biA9IGF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2J1dHRvblwiKTtcbmNvbnN0IGF2YXRhck1vZGFsQ2xvc2VCdG4gPSBhdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idG5cIik7XG5jb25zdCBhdmF0YXJJbnB1dCA9IGF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1hdmF0YXItaW5wdXRcIik7XG5cbi8vIERlbGV0ZSBmb3JtIGVsZW1lbnRzXG5jb25zdCBkZWxldGVNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZGVsZXRlLW1vZGFsXCIpO1xuY29uc3QgZGVsZXRlRm9ybSA9IGRlbGV0ZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjZGVsZXRlLWZvcm1cIik7XG5jb25zdCBkZWxldGVNb2RhbENsb3NlQnV0dG9uID0gZGVsZXRlTW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIuZGVsZXRlLW1vZGFsX19jbG9zZS1idG5cIlxuKTsgLy8gdHlwZT1cImJ1dHRvblwiXG5jb25zdCBkZWxldGVDYW5jZWxCdXR0b24gPSBkZWxldGVNb2RhbC5xdWVyeVNlbGVjdG9yKFxuICAnYnV0dG9uW3R5cGU9XCJidXR0b25cIl06bm90KC5kZWxldGUtbW9kYWxfX2Nsb3NlLWJ0biknXG4pO1xuaWYgKGRlbGV0ZUNhbmNlbEJ1dHRvbikge1xuICBkZWxldGVDYW5jZWxCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpKTtcbn1cblxuLy9OZXcgcG9zdCBtb2RhbFxuY29uc3QgbmV3UG9zdEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWRkLWJ0blwiKTtcbmNvbnN0IG5ld1Bvc3RNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYWRkLWNhcmQtbW9kYWxcIik7XG5jb25zdCBuZXdQb3N0Q2xvc2VCdG4gPSBuZXdQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2UtYnRuXCIpO1xuY29uc3QgbmV3UG9zdEZvcm0gPSBuZXdQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcbmNvbnN0IG5ld1Bvc3RJbWFnZUxpbmsgPSBuZXdQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIjYWRkLWNhcmQtaW1hZ2UtbGluay1pbnB1dFwiXG4pO1xuY29uc3QgbmV3UG9zdENhcHRpb24gPSBuZXdQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlLWNhcHRpb24taW5wdXRcIik7XG5cbmNvbnN0IHByZXZpZXdNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJldmlldy1tb2RhbFwiKTtcbmNvbnN0IHByZXZpZXdNb2RhbEltZ0VsID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2ltYWdlXCIpO1xuY29uc3QgcHJldmlld01vZGFsQ2FwdGlvbkVsID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2NhcHRpb25cIik7XG5jb25zdCBwcmV2aWV3TW9kYWxDbG9zZUJ0biA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFxuICBcIi5tb2RhbF9fY2xvc2UtYnRuX3R5cGVfcHJldmlld1wiXG4pO1xuXG5jb25zdCBjYXJkc0xpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRzX19saXN0XCIpO1xuXG5sZXQgc2VsZWN0ZWRDYXJkLCBzZWxlY3RlZENhcmRJZDtcbmxldCBjdXJyZW50VXNlcklkID0gbnVsbDtcblxuLy8gQ2FyZCByZWxhdGVkIGVsZW1lbnRzXG5jb25zdCBjYXJkVGVtcGxhdGUgPSBkb2N1bWVudFxuICAucXVlcnlTZWxlY3RvcihcIiNjYXJkLXRlbXBsYXRlXCIpXG4gIC5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZFwiKTtcblxuY29uc3QgdGVtcGxhdGVFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC10ZW1wbGF0ZVwiKTtcbmlmICghdGVtcGxhdGVFbCkge1xuICB0aHJvdyBuZXcgRXJyb3IoXCJNaXNzaW5nICNjYXJkLXRlbXBsYXRlIGluIGluZGV4Lmh0bWxcIik7XG59XG5cbmZ1bmN0aW9uIGdldENhcmRFbGVtZW50KGRhdGEpIHtcbiAgY29uc3QgY2FyZEVsZW1lbnQgPSBjYXJkVGVtcGxhdGUuY2xvbmVOb2RlKHRydWUpO1xuICBjb25zdCBpbWcgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xuICBjb25zdCB0aXRsZSA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fdGl0bGVcIik7XG4gIGNvbnN0IGRlbEJ0biA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fZGVsZXRlLWJ0blwiKTtcblxuICBpbWcuc3JjID0gZGF0YS5saW5rO1xuICBpbWcuYWx0ID0gZGF0YS5uYW1lO1xuICB0aXRsZS50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcblxuICBkZWxCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBzZWxlY3RlZENhcmQgPSBjYXJkRWxlbWVudDtcbiAgICBzZWxlY3RlZENhcmRJZCA9IGRhdGEuX2lkO1xuICAgIG9wZW5Nb2RhbChkZWxldGVNb2RhbCk7XG4gIH0pO1xuXG4gIGltZy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIG9wZW5Nb2RhbChwcmV2aWV3TW9kYWwpO1xuICAgIHByZXZpZXdNb2RhbEltZ0VsLnNyYyA9IGRhdGEubGluaztcbiAgICBwcmV2aWV3TW9kYWxJbWdFbC5hbHQgPSBkYXRhLm5hbWU7XG4gICAgcHJldmlld01vZGFsQ2FwdGlvbkVsLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuICB9KTtcblxuICBjb25zdCBjYXJkTGlrZUJ0biA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idG5cIik7XG4gIGlmIChjYXJkTGlrZUJ0bikge1xuICAgIGlmIChkYXRhLmlzTGlrZWQpIHtcbiAgICAgIGNhcmRMaWtlQnRuLmNsYXNzTGlzdC5hZGQoXCJjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmVcIik7XG4gICAgICBjYXJkTGlrZUJ0bi5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBgdXJsKCR7bGlrZWRVcmx9KWA7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNhcmRMaWtlQnRuLmNsYXNzTGlzdC5yZW1vdmUoXCJjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmVcIik7XG4gICAgICBjYXJkTGlrZUJ0bi5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBgdXJsKCR7aGVhcnRVcmx9KWA7XG4gICAgfVxuICAgIGNhcmRMaWtlQnRuLnN0eWxlLmJhY2tncm91bmRTaXplID0gXCJjb250YWluXCI7XG4gICAgY2FyZExpa2VCdG4uc3R5bGUuYmFja2dyb3VuZFJlcGVhdCA9IFwibm8tcmVwZWF0XCI7XG4gIH1cblxuICBjYXJkTGlrZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2dCkgPT4gaGFuZGxlTGlrZShldnQsIGRhdGEuX2lkKSk7XG5cbiAgcmV0dXJuIGNhcmRFbGVtZW50O1xufVxuXG5wcmV2aWV3TW9kYWxDbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBjbG9zZU1vZGFsKHByZXZpZXdNb2RhbCk7XG59KTtcblxuZnVuY3Rpb24gY2FyZERlbGV0ZUhhbmRsZXIoY2FyZEVsZW1lbnQsIGNhcmRJZCkge1xuICBzZWxlY3RlZENhcmQgPSBjYXJkRWxlbWVudDtcbiAgc2VsZWN0ZWRDYXJkSWQgPSBjYXJkSWQ7XG4gIG9wZW5Nb2RhbChkZWxldGVNb2RhbCk7XG59XG5cbmNvbnN0IG1vZGFscyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIubW9kYWxcIik7XG5tb2RhbHMuZm9yRWFjaCgobW9kYWwpID0+IHtcbiAgbW9kYWwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBjbG9zZU1vZGFsRXZlbnRzKTtcbn0pO1xuXG5jYXJkRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUFkZENhcmRTdWJtaXQpO1xuXG5mdW5jdGlvbiBvcGVuTW9kYWwobW9kYWwpIHtcbiAgdHJ5IHtcbiAgICBjb25zb2xlLmRlYnVnKFxuICAgICAgXCJvcGVuTW9kYWwgY2FsbGVkIGZvcjpcIixcbiAgICAgIG1vZGFsICYmIG1vZGFsLmlkID8gbW9kYWwuaWQgOiBtb2RhbFxuICAgICk7XG4gICAgY29uc29sZS50cmFjZSgpO1xuICB9IGNhdGNoIChlcnIpIHt9XG4gIG1vZGFsLmNsYXNzTGlzdC5hZGQoXCJtb2RhbF9vcGVuZWRcIik7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGNsb3NlTW9kYWxFdmVudHMpO1xufVxuXG5mdW5jdGlvbiBjbG9zZU1vZGFsKG1vZGFsKSB7XG4gIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoXCJtb2RhbF9vcGVuZWRcIik7XG4gIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGNsb3NlTW9kYWxFdmVudHMpO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVFZGl0Rm9ybVN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgY29uc3Qgc3VibWl0QnRuID0gZXZ0LnN1Ym1pdHRlcjtcbiAgY29uc3Qgb3JpZ2luYWxUZXh0ID0gc3VibWl0QnRuLnRleHRDb250ZW50O1xuICBzdWJtaXRCdG4udGV4dENvbnRlbnQgPSBcIlNhdmluZy4uLlwiO1xuICBzdWJtaXRCdG4uZGlzYWJsZWQgPSB0cnVlO1xuXG4gIGFwaVxuICAgIC5lZGl0VXNlckluZm8oe1xuICAgICAgbmFtZTogZWRpdE1vZGFsTmFtZUlucHV0LnZhbHVlLFxuICAgICAgYWJvdXQ6IGVkaXRNb2RhbERlc2NyaXB0aW9uSW5wdXQudmFsdWUsXG4gICAgfSlcbiAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgaWYgKHByb2ZpbGVOYW1lKSBwcm9maWxlTmFtZS50ZXh0Q29udGVudCA9IGRhdGEubmFtZSB8fCBcIlwiO1xuICAgICAgICBpZiAocHJvZmlsZURlc2NyaXB0aW9uKVxuICAgICAgICAgIHByb2ZpbGVEZXNjcmlwdGlvbi50ZXh0Q29udGVudCA9IGRhdGEuYWJvdXQgfHwgXCJcIjtcbiAgICAgIH1cbiAgICAgIGNsb3NlTW9kYWwoZWRpdE1vZGFsKTtcbiAgICAgIGRpc2FibGVCdXR0b24oc3VibWl0QnRuLCB2YWxpZGF0aW9uQ29uZmlnKTtcbiAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHN1Ym1pdEJ0bi50ZXh0Q29udGVudCA9IG9yaWdpbmFsVGV4dDtcbiAgICAgIHN1Ym1pdEJ0bi5kaXNhYmxlZCA9IGZhbHNlO1xuICAgIH0pO1xufVxuXG5lZGl0Rm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVFZGl0Rm9ybVN1Ym1pdCk7XG5cbmZ1bmN0aW9uIGhhbmRsZUFkZENhcmRTdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBjb25zdCBzdWJtaXRCdG4gPSBldnQuc3VibWl0dGVyO1xuICBjb25zdCBvcmlnaW5hbFRleHQgPSBzdWJtaXRCdG4udGV4dENvbnRlbnQ7XG4gIHN1Ym1pdEJ0bi50ZXh0Q29udGVudCA9IFwiU2F2aW5nLi4uXCI7XG4gIHN1Ym1pdEJ0bi5kaXNhYmxlZCA9IHRydWU7XG4gIGNvbnN0IGlucHV0VmFsdWVzID0geyBuYW1lOiBjYXJkTmFtZUlucHV0LnZhbHVlLCBsaW5rOiBjYXJkTGlua0lucHV0LnZhbHVlIH07XG5cbiAgYXBpXG4gICAgLmNyZWF0ZUNhcmQoaW5wdXRWYWx1ZXMpXG4gICAgLnRoZW4oKGNyZWF0ZWRDYXJkKSA9PiB7XG4gICAgICBjb25zdCBjYXJkRWxlbWVudCA9IGdldENhcmRFbGVtZW50KGNyZWF0ZWRDYXJkKTtcbiAgICAgIGNhcmRzTGlzdC5wcmVwZW5kKGNhcmRFbGVtZW50KTtcbiAgICAgIGNsb3NlTW9kYWwoY2FyZE1vZGFsKTtcbiAgICAgIGV2dC50YXJnZXQucmVzZXQoKTtcbiAgICAgIGRpc2FibGVCdXR0b24oc3VibWl0QnRuLCB2YWxpZGF0aW9uQ29uZmlnKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICBzdWJtaXRCdG4uZGlzYWJsZWQgPSBmYWxzZTtcbiAgICB9KVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHN1Ym1pdEJ0bi50ZXh0Q29udGVudCA9IG9yaWdpbmFsVGV4dDtcbiAgICB9KTtcbn1cblxuLy8gQXZhdGFyIG1vZGFsIG9wZW4gJiBjbG9zZSBoYW5kbGVyc1xuYXZhdGFyTW9kYWxCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgb3Blbk1vZGFsKGF2YXRhck1vZGFsKTtcbiAgcmVzZXRWYWxpZGF0aW9uKGF2YXRhck1vZGFsRm9ybSwgW2F2YXRhcklucHV0XSwgdmFsaWRhdGlvbkNvbmZpZyk7XG59KTtcblxuYXZhdGFyTW9kYWxDbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICBjbG9zZU1vZGFsKGF2YXRhck1vZGFsKTtcbn0pO1xuXG4vL3N1Ym1pdCBoYW5kbGVyIGZvciBhdmF0YXIgbW9kYWxcbmF2YXRhck1vZGFsRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGF2YXRhckhhbmRsZXJTdWJtaXQpO1xuXG5mdW5jdGlvbiBhdmF0YXJIYW5kbGVyU3VibWl0KGV2dCkge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgY29uc3Qgc3VibWl0QnRuID0gZXZ0LnN1Ym1pdHRlcjtcbiAgY29uc3Qgb3JpZ2luYWxUZXh0ID0gc3VibWl0QnRuLnRleHRDb250ZW50O1xuICBzdWJtaXRCdG4udGV4dENvbnRlbnQgPSBcIlNhdmluZy4uLlwiO1xuICBzdWJtaXRCdG4uZGlzYWJsZWQgPSB0cnVlO1xuICBhcGlcbiAgICAudXBkYXRlVXNlckF2YXRhcih7IGF2YXRhcjogYXZhdGFySW5wdXQudmFsdWUgfSlcbiAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgaWYgKGRhdGEgJiYgZGF0YS5hdmF0YXIpIHtcbiAgICAgICAgY29uc3QgcHJvZmlsZUF2YXRhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyXCIpO1xuICAgICAgICBpZiAocHJvZmlsZUF2YXRhcikge1xuICAgICAgICAgIHByb2ZpbGVBdmF0YXIuYWx0ID0gXCJVc2VyIGF2YXRhclwiO1xuICAgICAgICAgIHByb2ZpbGVBdmF0YXIuc3JjID0gZGF0YS5hdmF0YXI7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNsb3NlTW9kYWwoYXZhdGFyTW9kYWwpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgIHN1Ym1pdEJ0bi5kaXNhYmxlZCA9IGZhbHNlO1xuICAgIH0pXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgc3VibWl0QnRuLnRleHRDb250ZW50ID0gb3JpZ2luYWxUZXh0O1xuICAgIH0pO1xufVxuXG5wcm9maWxlRWRpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBlZGl0TW9kYWxOYW1lSW5wdXQudmFsdWUgPSBwcm9maWxlTmFtZS50ZXh0Q29udGVudDtcbiAgZWRpdE1vZGFsRGVzY3JpcHRpb25JbnB1dC52YWx1ZSA9IHByb2ZpbGVEZXNjcmlwdGlvbi50ZXh0Q29udGVudDtcbiAgcmVzZXRWYWxpZGF0aW9uKFxuICAgIGVkaXRGb3JtRWxlbWVudCxcbiAgICBbZWRpdE1vZGFsTmFtZUlucHV0LCBlZGl0TW9kYWxEZXNjcmlwdGlvbklucHV0XSxcbiAgICB2YWxpZGF0aW9uQ29uZmlnXG4gICk7XG4gIG9wZW5Nb2RhbChlZGl0TW9kYWwpO1xufSk7XG5cbmVkaXRQcm9maWxlQ2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgY2xvc2VNb2RhbChlZGl0TW9kYWwpO1xufSk7XG5cbm5ld1Bvc3RCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgb3Blbk1vZGFsKG5ld1Bvc3RNb2RhbCk7XG4gIHJlc2V0VmFsaWRhdGlvbihcbiAgICBuZXdQb3N0Rm9ybSxcbiAgICBbbmV3UG9zdEltYWdlTGluaywgbmV3UG9zdENhcHRpb25dLFxuICAgIHZhbGlkYXRpb25Db25maWdcbiAgKTtcbn0pO1xuXG5uZXdQb3N0Q2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgY2xvc2VNb2RhbChuZXdQb3N0TW9kYWwpO1xufSk7XG5cbmZ1bmN0aW9uIGNsb3NlTW9kYWxFdmVudHMoZXZlbnQpIHtcbiAgY29uc3Qgb3BlbmVkTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX29wZW5lZFwiKTtcblxuICBpZiAoZXZlbnQudHlwZSA9PT0gXCJrZXlkb3duXCIgJiYgZXZlbnQua2V5ID09PSBcIkVzY2FwZVwiICYmIG9wZW5lZE1vZGFsKSB7XG4gICAgY2xvc2VNb2RhbChvcGVuZWRNb2RhbCk7XG4gIH1cblxuICBpZiAoZXZlbnQudHlwZSA9PT0gXCJtb3VzZWRvd25cIikge1xuICAgIGlmIChldmVudC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxcIikpIHtcbiAgICAgIGNsb3NlTW9kYWwoZXZlbnQudGFyZ2V0KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcImRlbGV0ZS1tb2RhbF9fY2xvc2UtYnRuXCIpKSB7XG4gICAgICBjb25zdCBtb2RhbCA9IGV2ZW50LnRhcmdldC5jbG9zZXN0KFwiLm1vZGFsXCIpO1xuICAgICAgaWYgKG1vZGFsKSBjbG9zZU1vZGFsKG1vZGFsKTtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gaGFuZGxlTGlrZShldnQsIGNhcmRJZCkge1xuICBjb25zdCBsaWtlQnRuID0gZXZ0LnRhcmdldC5jbG9zZXN0KFwiLmNhcmRfX2xpa2UtYnRuXCIpO1xuICBpZiAoIWxpa2VCdG4pIHJldHVybjtcblxuICBjb25zdCBpc0xpa2VkID0gbGlrZUJ0bi5jbGFzc0xpc3QuY29udGFpbnMoXCJjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmVcIik7XG4gIGFwaVxuICAgIC5saWtlU3RhdHVzKHsgY2FyZElkLCBpc0xpa2VkIH0pXG4gICAgLnRoZW4oKHVwZGF0ZWRDYXJkKSA9PiB7XG4gICAgICBpZiAodXBkYXRlZENhcmQuaXNMaWtlZCkge1xuICAgICAgICBsaWtlQnRuLmNsYXNzTGlzdC5hZGQoXCJjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmVcIik7XG4gICAgICAgIGxpa2VCdG4uc3R5bGUuYmFja2dyb3VuZEltYWdlID0gYHVybCgke2xpa2VkVXJsfSlgO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbGlrZUJ0bi5jbGFzc0xpc3QucmVtb3ZlKFwiY2FyZF9fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xuICAgICAgICBsaWtlQnRuLnN0eWxlLmJhY2tncm91bmRJbWFnZSA9IGB1cmwoJHtoZWFydFVybH0pYDtcbiAgICAgIH1cbiAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKTtcbn1cblxuY2FyZE1vZGFsQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIG9wZW5Nb2RhbChjYXJkTW9kYWwpO1xufSk7XG5cbmRlbGV0ZUZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZSkgPT4ge1xuICBlLnByZXZlbnREZWZhdWx0KCk7XG4gIGNvbnN0IHN1Ym1pdEJ0biA9IGUuc3VibWl0dGVyO1xuICBjb25zdCBvcmlnaW5hbFRleHQgPSBzdWJtaXRCdG4udGV4dENvbnRlbnQ7XG4gIHN1Ym1pdEJ0bi50ZXh0Q29udGVudCA9IFwiRGVsZXRpbmcuLi5cIjtcbiAgc3VibWl0QnRuLmRpc2FibGVkID0gdHJ1ZTtcbiAgaWYgKHNlbGVjdGVkQ2FyZElkKSB7XG4gICAgYXBpXG4gICAgICAuZGVsZXRlQ2FyZChzZWxlY3RlZENhcmRJZClcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgaWYgKHNlbGVjdGVkQ2FyZCkgc2VsZWN0ZWRDYXJkLnJlbW92ZSgpO1xuICAgICAgICBzZWxlY3RlZENhcmQgPSBudWxsO1xuICAgICAgICBzZWxlY3RlZENhcmRJZCA9IG51bGw7XG4gICAgICAgIGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaChjb25zb2xlLmVycm9yKVxuICAgICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgICBzdWJtaXRCdG4udGV4dENvbnRlbnQgPSBvcmlnaW5hbFRleHQ7XG4gICAgICAgIHN1Ym1pdEJ0bi5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgfSk7XG4gICAgcmV0dXJuO1xuICB9XG59KTtcblxuZGVsZXRlTW9kYWxDbG9zZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gY2xvc2VNb2RhbChkZWxldGVNb2RhbCkpO1xuXG5lbmFibGVWYWxpZGF0aW9uKHZhbGlkYXRpb25Db25maWcpO1xuXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCAoKSA9PiB7XG4gIGNvbnN0IG9wZW5lZCA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5tb2RhbF9vcGVuZWRcIikpO1xuICBpZiAob3BlbmVkLmxlbmd0aCkge1xuICAgIHRyeSB7XG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgIFwiRm91bmQgbW9kYWwocykgb3BlbmVkIG9uIGxvYWQsIGNsb3NpbmcgdGhlbTpcIixcbiAgICAgICAgb3BlbmVkLm1hcCgobSkgPT4gbS5pZCB8fCBtKVxuICAgICAgKTtcbiAgICB9IGNhdGNoIChlcnIpIHt9XG4gIH1cbiAgb3BlbmVkLmZvckVhY2goKG0pID0+IG0uY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX29wZW5lZFwiKSk7XG5cbiAgdHJ5IHtcbiAgICBsb2FkSW5pdGlhbERhdGEoKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBjYWxsIGxvYWRJbml0aWFsRGF0YTpcIiwgZXJyKTtcbiAgfVxufSk7XG4iXSwibmFtZXMiOlsiX193ZWJwYWNrX3JlcXVpcmVfXyIsImciLCJnbG9iYWxUaGlzIiwidGhpcyIsIkZ1bmN0aW9uIiwiZSIsIndpbmRvdyIsInNjcmlwdFVybCIsImltcG9ydFNjcmlwdHMiLCJsb2NhdGlvbiIsImRvY3VtZW50IiwiY3VycmVudFNjcmlwdCIsInNyYyIsInNjcmlwdHMiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsImxlbmd0aCIsIkVycm9yIiwicmVwbGFjZSIsInAiLCJ2YWxpZGF0aW9uQ29uZmlnIiwiZm9ybVNlbGVjdG9yIiwic2F2ZUJ1dHRvblNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsImlucHV0RXJyb3JDbGFzcyIsImVycm9yQ2xhc3MiLCJoaWRlSW5wdXRFcnJvciIsImZvcm1FbCIsImlucHV0RWwiLCJjb25maWciLCJlcnJvck1zZ0lEIiwiaWQiLCJxdWVyeVNlbGVjdG9yIiwidGV4dENvbnRlbnQiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJ0b2dnbGVCdXR0b25TdGF0ZSIsImlucHV0TGlzdCIsImJ1dHRvbkVsIiwic29tZSIsImlucHV0IiwidmFsaWRpdHkiLCJ2YWxpZCIsImhhc0ludmFsaWRJbnB1dCIsImRpc2FibGVCdXR0b24iLCJkaXNhYmxlZCIsImFkZCIsInJlc2V0VmFsaWRhdGlvbiIsImZvckVhY2giLCJhcGkiLCJjb25zdHJ1Y3RvciIsImJhc2VVcmwiLCJoZWFkZXJzIiwiX2Jhc2VVcmwiLCJfaGVhZGVycyIsIl9oYW5kbGVSZXNwb25zZSIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJnZXRBcHBJbmZvIiwiYWxsIiwiZ2V0VXNlckluZm8iLCJnZXRJbml0aWFsQ2FyZHMiLCJmZXRjaCIsInRoZW4iLCJlZGl0VXNlckluZm8iLCJuYW1lIiwiYWJvdXQiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImVkaXRBdmF0YXJJbmZvIiwiYXZhdGFyIiwiY3JlYXRlQ2FyZCIsImxpbmsiLCJkZWxldGVDYXJkIiwiY2hhbmdlTGlrZVN0YXR1cyIsImlzTGlrZWQiLCJsaWtlU3RhdHVzIiwiY2FyZElkIiwidXBkYXRlVXNlckF2YXRhciIsImF1dGhvcml6YXRpb24iLCJhZGRFdmVudExpc3RlbmVyIiwibG9nb0ltZyIsImxvZ29VcmwiLCJwcm9maWxlRWRpdEljb24iLCJwZW5jaWxVcmwiLCJwcm9maWxlUGVuY2lsSWNvbiIsInBlbmNpbExpZ2h0VXJsIiwiYWRkSWNvbiIsInBsdXNVcmwiLCJwcm9maWxlRWRpdEJ1dHRvbiIsImNhcmRNb2RhbEJ0biIsImF2YXRhck1vZGFsQnRuIiwicHJvZmlsZU5hbWUiLCJwcm9maWxlRGVzY3JpcHRpb24iLCJlZGl0TW9kYWwiLCJlZGl0Rm9ybUVsZW1lbnQiLCJlZGl0UHJvZmlsZUNsb3NlQnRuIiwiZWRpdE1vZGFsTmFtZUlucHV0IiwiZWRpdE1vZGFsRGVzY3JpcHRpb25JbnB1dCIsImNhcmRNb2RhbCIsImNhcmRGb3JtIiwiY2FyZE5hbWVJbnB1dCIsImNhcmRMaW5rSW5wdXQiLCJhdmF0YXJNb2RhbCIsImF2YXRhck1vZGFsRm9ybSIsImF2YXRhck1vZGFsQ2xvc2VCdG4iLCJhdmF0YXJJbnB1dCIsImRlbGV0ZU1vZGFsIiwiZGVsZXRlRm9ybSIsImRlbGV0ZU1vZGFsQ2xvc2VCdXR0b24iLCJkZWxldGVDYW5jZWxCdXR0b24iLCJjbG9zZU1vZGFsIiwibmV3UG9zdEJ0biIsIm5ld1Bvc3RNb2RhbCIsIm5ld1Bvc3RDbG9zZUJ0biIsIm5ld1Bvc3RJbWFnZUxpbmsiLCJuZXdQb3N0Q2FwdGlvbiIsInByZXZpZXdNb2RhbCIsInByZXZpZXdNb2RhbEltZ0VsIiwicHJldmlld01vZGFsQ2FwdGlvbkVsIiwicHJldmlld01vZGFsQ2xvc2VCdG4iLCJjYXJkc0xpc3QiLCJzZWxlY3RlZENhcmQiLCJzZWxlY3RlZENhcmRJZCIsImN1cnJlbnRVc2VySWQiLCJjYXJkVGVtcGxhdGUiLCJjb250ZW50IiwiZ2V0Q2FyZEVsZW1lbnQiLCJkYXRhIiwiY2FyZEVsZW1lbnQiLCJjbG9uZU5vZGUiLCJpbWciLCJ0aXRsZSIsImRlbEJ0biIsImFsdCIsIl9pZCIsIm9wZW5Nb2RhbCIsImNhcmRMaWtlQnRuIiwic3R5bGUiLCJiYWNrZ3JvdW5kSW1hZ2UiLCJsaWtlZFVybCIsImhlYXJ0VXJsIiwiYmFja2dyb3VuZFNpemUiLCJiYWNrZ3JvdW5kUmVwZWF0IiwiZXZ0IiwibGlrZUJ0biIsInRhcmdldCIsImNsb3Nlc3QiLCJjb250YWlucyIsInVwZGF0ZWRDYXJkIiwiY2F0Y2giLCJjb25zb2xlIiwiZXJyb3IiLCJoYW5kbGVMaWtlIiwibW9kYWwiLCJkZWJ1ZyIsInRyYWNlIiwiZXJyIiwiY2xvc2VNb2RhbEV2ZW50cyIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJldmVudCIsIm9wZW5lZE1vZGFsIiwidHlwZSIsImtleSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJwcmV2ZW50RGVmYXVsdCIsInN1Ym1pdEJ0biIsInN1Ym1pdHRlciIsIm9yaWdpbmFsVGV4dCIsImlucHV0VmFsdWVzIiwidmFsdWUiLCJjcmVhdGVkQ2FyZCIsInByZXBlbmQiLCJyZXNldCIsImZpbmFsbHkiLCJwcm9maWxlQXZhdGFyIiwibmV3UG9zdEZvcm0iLCJzZXRFdmVudExpc3RlbmVycyIsImZvcm1FbGVtZW50IiwiQXJyYXkiLCJmcm9tIiwiYnV0dG9uRWxlbWVudCIsImlucHV0RWxlbWVudCIsImNoZWNrSW5wdXRWYWxpZGl0eSIsInNob3dJbnB1dEVycm9yIiwiZXJyb3JNc2ciLCJ2YWxpZGF0aW9uTWVzc2FnZSIsIm9wZW5lZCIsIndhcm4iLCJtYXAiLCJtIiwidXNlciIsImNhcmRzIiwiYXZhdGFyRWwiLCJuYW1lRWwiLCJkZXNjRWwiLCJsb2ciLCJpc0FycmF5IiwiaXRlbSJdLCJzb3VyY2VSb290IjoiIn0=